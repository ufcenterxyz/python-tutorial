# Python 文件操作基础

## 要点总结

1. **文件打开与关闭**：
   - 使用 `open()` 函数打开文件
   - 文件模式：`"r"` (读取)，`"w"` (写入)，`"rb"` (二进制读取)，`"wb"` (二进制写入)
   - 文件使用完毕后必须使用 `close()` 方法关闭

2. **文件路径**：
   - 可以使用相对路径或绝对路径
   - 对于包含特殊字符的Windows路径，使用原始字符串 `r"路径"`

3. **读取文件方法**：
   - `read()` - 读取整个文件内容
   - `readline()` - 读取单行
   - `readlines()` - 读取所有行并返回列表
   - 使用循环逐行读取
   - 使用 `read(size)` 分块读取

4. **写入文件方法**：
   - `write()` - 写入字符串
   - `writelines()` - 写入字符串列表

5. **with语句**：
   - 使用上下文管理器自动处理文件关闭
   - 推荐的文件处理方式

6. **错误处理**：
   - 使用 `try/except` 捕获 `IOError`
   - 确保文件正确关闭

## 理解方法

- 将文件操作视为与外部存储的通信过程
- 养成使用 `with` 语句的习惯，避免忘记关闭文件
- 理解不同读取方法的适用场景：小文件用 `read()`，大文件用分块读取或逐行读取
- 注意写入模式 `"w"` 会覆盖现有文件，需谨慎使用

## 练习题

### 1. 基础文件读取

**题目**：创建一个名为 `hello.txt` 的文本文件，内容包含三行文本。编写一个程序，读取并打印该文件的全部内容。

**解题思路**：
- 使用 `open()` 函数打开文件
- 使用 `read()` 方法读取全部内容
- 使用 `print()` 函数打印内容
- 关闭文件

**验收标准**：
- 程序能正确打开并读取文件
- 控制台输出与文件内容完全一致
- 文件在使用后被正确关闭
- 使用了正确的文件模式 (`"r"` 或默认)

### 2. 逐行读取文件

**题目**：创建一个包含5行数字的文本文件，每行一个整数。编写程序读取这些数字并计算它们的总和。

**解题思路**：
- 使用 `with` 语句打开文件
- 使用循环逐行读取文件
- 将每行转换为整数并累加
- 打印总和

**验收标准**：
- 程序能正确计算文件中所有数字的总和
- 使用了 `with` 语句处理文件
- 程序能处理文件中的每一行
- 正确处理字符串到整数的转换

### 3. 文件写入

**题目**：编写一个程序，让用户输入5个名字，然后将这些名字写入到一个名为 `names.txt` 的文件中，每个名字占一行。

**解题思路**：
- 使用循环获取用户输入
- 使用 `open()` 函数以写入模式打开文件
- 使用 `write()` 方法写入每个名字，注意添加换行符
- 关闭文件

**验收标准**：
- 程序能接受用户输入的5个名字
- 创建或覆盖 `names.txt` 文件
- 文件中包含5个名字，每个名字占一行
- 文件在写入后被正确关闭

### 4. 使用with语句

**题目**：重写练习3，使用 `with` 语句来处理文件操作。

**解题思路**：
- 使用循环获取用户输入
- 使用 `with` 语句以写入模式打开文件
- 在 `with` 块内使用 `write()` 方法写入名字
- 不需要显式关闭文件

**验收标准**：
- 程序功能与练习3相同
- 使用了 `with` 语句而不是显式的 `open()` 和 `close()`
- 文件在 `with` 块结束后自动关闭
- 代码更简洁，没有冗余的文件关闭操作

### 5. 文件追加

**题目**：编写一个程序，向已有的文本文件 `log.txt` 追加一行当前日期和时间。如果文件不存在，则创建它。

**解题思路**：
- 使用 `"a"` 模式（追加模式）打开文件
- 导入 `datetime` 模块获取当前日期和时间
- 将格式化的日期时间字符串写入文件
- 关闭文件

**验收标准**：
- 程序能正确打开文件，不论文件是否存在
- 使用了正确的追加模式 `"a"`
- 成功写入当前日期和时间
- 如果多次运行，每次都会在文件末尾添加新行，而不是覆盖文件

### 6. 错误处理

**题目**：编写一个程序，尝试打开一个可能不存在的文件 `nonexistent.txt`，并使用 `try/except` 结构处理可能出现的 `IOError`。

**解题思路**：
- 使用 `try/except` 结构包裹文件操作代码
- 尝试打开不存在的文件
- 捕获 `IOError` 并打印友好的错误信息

**验收标准**：
- 程序尝试打开不存在的文件
- 正确捕获 `IOError` 异常
- 显示有意义的错误消息
- 程序不会因异常而崩溃

### 7. 二进制文件处理

**题目**：编写一个程序，创建一个包含10个随机整数的二进制文件，然后读取这个文件并打印这些整数。

**解题思路**：
- 导入 `random` 模块生成随机数
- 使用 `"wb"` 模式打开文件进行二进制写入
- 使用 `struct` 模块将整数打包为二进制数据
- 关闭文件后，再以 `"rb"` 模式打开并读取
- 解包二进制数据为整数并打印

**验收标准**：
- 程序能创建二进制文件并写入10个随机整数
- 使用了正确的二进制模式 `"wb"` 和 `"rb"`
- 能正确读取并解析二进制数据
- 打印出的整数与写入的整数相同

### 8. 文件复制

**题目**：编写一个程序，复制一个文本文件的内容到另一个文件。程序应接受两个命令行参数：源文件名和目标文件名。

**解题思路**：
- 导入 `sys` 模块获取命令行参数
- 检查参数数量是否正确
- 打开源文件进行读取
- 打开目标文件进行写入
- 读取源文件内容并写入目标文件
- 关闭两个文件

**验收标准**：
- 程序能接受两个命令行参数
- 正确打开源文件和目标文件
- 完整复制源文件内容到目标文件
- 处理可能的文件不存在错误
- 目标文件与源文件内容相同

### 9. 大文件处理

**题目**：编写一个程序，读取一个大文本文件（可以自己创建一个包含多行文本的文件），并统计文件中包含的行数、单词数和字符数。

**解题思路**：
- 使用 `with` 语句打开文件
- 初始化计数器变量
- 逐行读取文件，避免一次性加载整个文件
- 对每行进行处理：增加行计数，计算单词数（通过分割空格），计算字符数
- 打印统计结果

**验收标准**：
- 程序能处理大文件而不消耗过多内存
- 正确计算文件的行数、单词数和字符数
- 使用了逐行处理而非 `read()` 方法
- 输出格式清晰，显示所有三个统计结果

### 10. 综合应用

**题目**：创建一个简单的日志系统。编写两个函数：`log_message(message)` 将消息和时间戳写入日志文件；`read_log()` 读取并显示最近10条日志消息。

**解题思路**：
- 定义 `log_message` 函数，使用追加模式打开日志文件
- 在消息前添加时间戳，并写入文件
- 定义 `read_log` 函数，读取整个日志文件
- 将日志分割为行，并获取最后10行
- 打印这些行

**验收标准**：
- `log_message` 函数能正确将消息和时间戳写入文件
- 多次调用 `log_message` 会在文件末尾追加内容
- `read_log` 函数能正确显示最近的10条消息
- 如果日志条目少于10条，显示所有可用条目
- 两个函数都使用了 `with` 语句处理文件
- 日志格式一致，便于阅读
