# Python 异常处理总结与练习

## 要点总结

异常处理是 Python 中处理错误情况的机制，主要通过 try/except 结构实现。以下是关键要点：

1. **异常的概念**：当程序执行过程中出现错误时，Python 会抛出异常。异常是一种对象，继承自 Exception 类。

2. **常见异常类型**：
   - `Exception`：大多数异常的基类
   - `AttributeError`：属性引用或赋值失败
   - `IOError`：I/O 操作失败
   - `ImportError`：导入模块失败
   - `IndexError`：序列下标超出范围
   - `KeyError`：字典中找不到指定的键
   - `KeyboardInterrupt`：用户按下中断键
   - `NameError`：找不到局部或全局名称
   - `OSError`：系统相关错误
   - `SyntaxError`：语法错误
   - `TypeError`：对不适当类型的对象应用操作或函数
   - `ValueError`：操作或函数接收到类型正确但值不合适的参数
   - `ZeroDivisionError`：除法或取模操作的第二个参数为零

3. **异常处理结构**：
   - `try/except`：基本异常捕获结构
   - `try/except/else`：无异常时执行 else 块
   - `try/except/finally`：无论是否有异常都执行 finally 块
   - `try/except/else/finally`：完整结构

4. **多异常处理**：
   - 可以使用多个 except 块捕获不同类型的异常
   - 可以在一个 except 语句中捕获多种异常：`except (Exception1, Exception2):`

5. **避免使用裸异常**：不推荐使用 `except:` 不指定异常类型的形式，因为它会捕获所有异常，包括 KeyboardInterrupt，使调试变得困难。

6. **清理操作**：使用 finally 块进行资源清理，无论是否发生异常都会执行。

7. **else 子句**：仅在没有异常发生时执行，通常用于执行可能引发异常的后续代码。

## 理解方法

1. **实践学习**：通过编写可能引发异常的代码，然后添加异常处理来学习。
2. **从简单到复杂**：先掌握基本的 try/except，再学习 finally 和 else 的用法。
3. **理解异常层次**：了解 Python 异常的继承关系，有助于更有效地捕获异常。
4. **情境思考**：考虑什么情况下需要异常处理，例如文件操作、网络请求、用户输入等。

## 练习题

### 1. 基本异常捕获

**题目**：编写一个函数，接受两个数字作为参数，返回它们的除法结果。使用异常处理来处理除以零的情况。

**解题思路**：使用 try/except 结构捕获 ZeroDivisionError。

**验收标准**：
- 函数应接受两个参数
- 当第二个参数为零时，应捕获 ZeroDivisionError 并返回一个友好的错误消息
- 当除法成功时，应返回正确的结果
- 必须使用 try/except 结构

### 2. 字典键查找

**题目**：创建一个函数，接受一个字典和一个键作为参数，返回该键对应的值。使用异常处理来处理键不存在的情况。

**解题思路**：使用 try/except 捕获 KeyError。

**验收标准**：
- 函数应接受一个字典和一个键作为参数
- 当键不存在时，应捕获 KeyError 并返回一个友好的错误消息
- 当键存在时，应返回对应的值
- 必须使用 try/except 结构

### 3. 列表索引访问

**题目**：编写一个函数，接受一个列表和一个索引作为参数，返回该索引处的元素。使用异常处理来处理索引超出范围的情况。

**解题思路**：使用 try/except 捕获 IndexError。

**验收标准**：
- 函数应接受一个列表和一个索引作为参数
- 当索引超出范围时，应捕获 IndexError 并返回一个友好的错误消息
- 当索引有效时，应返回对应的元素
- 必须使用 try/except 结构

### 4. 文件读取

**题目**：编写一个函数，接受一个文件路径作为参数，尝试打开并读取文件内容。使用异常处理来处理文件不存在的情况。

**解题思路**：使用 try/except 捕获 FileNotFoundError。

**验收标准**：
- 函数应接受一个文件路径作为参数
- 当文件不存在时，应捕获 FileNotFoundError 并返回一个友好的错误消息
- 当文件存在时，应返回文件内容
- 必须使用 try/except 结构

### 5. 类型转换

**题目**：编写一个函数，接受一个字符串作为参数，尝试将其转换为整数。使用异常处理来处理无法转换的情况。

**解题思路**：使用 try/except 捕获 ValueError。

**验收标准**：
- 函数应接受一个字符串作为参数
- 当字符串无法转换为整数时，应捕获 ValueError 并返回一个友好的错误消息
- 当字符串可以转换为整数时，应返回转换后的整数
- 必须使用 try/except 结构

### 6. 多异常处理

**题目**：编写一个函数，接受一个列表和一个索引作为参数，尝试将该索引处的元素转换为整数并返回。使用异常处理来处理索引错误和类型转换错误。

**解题思路**：使用多个 except 块分别捕获 IndexError 和 ValueError。

**验收标准**：
- 函数应接受一个列表和一个索引作为参数
- 当索引超出范围时，应捕获 IndexError 并返回相应的错误消息
- 当元素无法转换为整数时，应捕获 ValueError 并返回相应的错误消息
- 当操作成功时，应返回转换后的整数
- 必须使用多个 except 块

### 7. 使用 finally 清理资源

**题目**：编写一个函数，模拟打开和关闭数据库连接。使用 try/except/finally 结构确保无论是否发生异常，连接都会被关闭。

**解题思路**：使用 try/except 处理可能的异常，使用 finally 确保资源释放。

**验收标准**：
- 函数应模拟打开数据库连接（可以用打印语句表示）
- 函数应在 try 块中执行一些操作（可以是简单的打印语句）
- 函数应在 finally 块中关闭连接（可以用打印语句表示）
- 无论是否发生异常，finally 块中的代码都应执行
- 必须使用 try/except/finally 结构

### 8. 使用 else 子句

**题目**：编写一个函数，接受一个字典和一个键作为参数。在 try 块中检查键是否存在，如果存在，在 else 块中返回该键对应的值。

**解题思路**：使用 try/except/else 结构，在 try 中检查键是否存在，在 else 中返回值。

**验收标准**：
- 函数应接受一个字典和一个键作为参数
- 当键不存在时，应捕获 KeyError 并返回一个友好的错误消息
- 当键存在时，应在 else 块中返回对应的值
- 必须使用 try/except/else 结构

### 9. 自定义异常

**题目**：创建一个自定义异常类 `NegativeNumberError`，然后编写一个函数，当传入的参数为负数时抛出该异常。

**解题思路**：定义一个继承自 Exception 的自定义异常类，然后在函数中使用 raise 语句抛出异常。

**验收标准**：
- 应定义一个名为 `NegativeNumberError` 的异常类，继承自 Exception
- 函数应接受一个数字作为参数
- 当参数为负数时，应抛出 NegativeNumberError
- 当参数为非负数时，函数应正常执行
- 必须使用 raise 语句

### 10. 重新抛出异常

**题目**：编写一个函数，接受一个列表作为参数，尝试访问第一个元素。如果发生 IndexError，打印一条消息后重新抛出异常。

**解题思路**：使用 try/except 捕获异常，然后使用 raise 重新抛出。

**验收标准**：
- 函数应接受一个列表作为参数
- 当列表为空时，应捕获 IndexError，打印一条消息，然后重新抛出异常
- 当列表不为空时，应返回第一个元素
- 必须使用 try/except 结构和 raise 语句

### 11. 嵌套异常处理

**题目**：编写一个函数，接受一个字典和一个键作为参数。在外层 try 块中尝试访问该键，在内层 try 块中尝试将值转换为整数。

**解题思路**：使用嵌套的 try/except 结构处理不同层次的异常。

**验收标准**：
- 函数应接受一个字典和一个键作为参数
- 外层 try/except 应处理 KeyError
- 内层 try/except 应处理 ValueError
- 当键不存在时，应返回相应的错误消息
- 当值无法转换为整数时，应返回相应的错误消息
- 当操作成功时，应返回转换后的整数
- 必须使用嵌套的 try/except 结构

### 12. 异常参数

**题目**：编写一个函数，接受一个文件路径作为参数，尝试打开文件。捕获异常并打印异常的详细信息。

**解题思路**：捕获异常后，使用异常对象的属性或 str() 函数获取详细信息。

**验收标准**：
- 函数应接受一个文件路径作为参数
- 当文件不存在时，应捕获异常并打印异常的详细信息
- 打印的信息应包含异常类型和异常消息
- 必须使用 try/except 结构和异常对象

### 13. 多种异常类型的处理

**题目**：编写一个函数，接受两个参数。尝试将第一个参数除以第二个参数，然后将结果转换为字符串。处理可能发生的多种异常。

**解题思路**：使用多个 except 块或一个 except 块捕获多种异常。

**验收标准**：
- 函数应接受两个参数
- 应处理 ZeroDivisionError（当第二个参数为零时）
- 应处理 TypeError（当参数不是数字时）
- 当发生异常时，应返回相应的错误消息
- 当操作成功时，应返回结果的字符串表示
- 必须使用 try/except 结构

### 14. 异常链

**题目**：编写一个函数，在 try 块中抛出一个异常，然后在 except 块中抛出另一个异常，同时保留原始异常信息。

**解题思路**：使用 raise ... from ... 语法创建异常链。

**验收标准**：
- 函数应在 try 块中抛出一个异常
- 函数应在 except 块中捕获该异常，然后抛出另一个异常
- 新异常应包含对原始异常的引用
- 必须使用 raise ... from ... 语法

### 15. 使用 assert

**题目**：编写一个函数，接受一个年龄参数。使用 assert 语句确保年龄是一个正整数。

**解题思路**：使用 assert 语句检查条件，如果条件为假，则抛出 AssertionError。

**验收标准**：
- 函数应接受一个年龄参数
- 函数应使用 assert 语句检查年龄是否为正整数
- 当年龄不是正整数时，应抛出 AssertionError
- 当年龄是正整数时，函数应正常执行
- 必须使用 assert 语句

### 16. 上下文管理与异常

**题目**：编写一个函数，使用 with 语句打开一个文件，读取内容，并处理可能的异常。

**解题思路**：使用 with 语句自动处理文件关闭，结合 try/except 处理可能的异常。

**验收标准**：
- 函数应接受一个文件路径作为参数
- 函数应使用 with 语句打开文件
- 函数应处理 FileNotFoundError
- 当文件不存在时，应返回相应的错误消息
- 当文件存在时，应返回文件内容
- 必须使用 with 语句和 try/except 结构

### 17. 全局异常处理

**题目**：编写一个程序，包含一个可能引发不同类型异常的主函数和一个全局异常处理函数。使用装饰器将全局异常处理应用到主函数。

**解题思路**：定义一个装饰器函数，在其中使用 try/except 捕获所有异常。

**验收标准**：
- 应定义一个装饰器函数，用于捕获异常
- 应定义一个主函数，可能引发不同类型的异常
- 装饰器应应用到主函数
- 当主函数抛出异常时，装饰器应捕获并处理异常
- 必须使用装饰器和 try/except 结构

### 18. 异常处理与日志记录

**题目**：编写一个函数，尝试执行一些操作，并使用 logging 模块记录可能发生的异常。

**解题思路**：导入 logging 模块，设置基本配置，然后在 except 块中使用 logging.error() 记录异常。

**验收标准**：
- 函数应导入 logging 模块并设置基本配置
- 函数应尝试执行一些可能引发异常的操作
- 当发生异常时，函数应使用 logging.error() 记录异常信息
- 日志信息应包含异常类型和异常消息
- 必须使用 try/except 结构和 logging 模块

### 19. 异常处理与用户输入验证

**题目**：编写一个函数，提示用户输入一个数字，并使用异常处理验证输入是否有效。

**解题思路**：使用 input() 获取用户输入，然后尝试将其转换为数字，使用 try/except 捕获可能的异常。

**验收标准**：
- 函数应使用 input() 获取用户输入
- 函数应尝试将输入转换为数字
- 当输入无效时，应捕获 ValueError 并提示用户重新输入
- 当输入有效时，应返回转换后的数字
- 必须使用 try/except 结构

### 20. 异常处理与资源管理

**题目**：编写一个自定义上下文管理器类，模拟数据库连接。确保在退出上下文时关闭连接，即使发生异常也是如此。

**解题思路**：定义一个类，实现 `__enter__` 和 `__exit__` 方法。在 `__exit__` 方法中处理异常并确保资源释放。

**验收标准**：
- 应定义一个自定义上下文管理器类
- 类应实现 `__enter__` 和 `__exit__` 方法
- `__enter__` 方法应模拟打开连接
- `__exit__` 方法应模拟关闭连接，无论是否发生异常
- 应提供一个使用该上下文管理器的示例
- 必须实现正确的上下文管理器协议
